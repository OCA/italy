<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="report_giornale">
        <t t-call="web.html_container">
            <t t-set="title" t-value="'Stampa libro giornale'"/>
            <t t-set="l10n_it_count_fiscal_year" t-value="year_footer"/>
            <t t-call="l10n_it_account.internal_layout">
                <div class="article">
                    <t t-set="print_details" t-value="1"/>
                    <t t-set="number_row" t-value="print_row"/>
                    <t t-set="counter" t-value="start_row"/>
                    <t t-set="save_move_id" t-value="0"/>
                    <t t-set="tot_credit" t-value="progressive_credit"/>
                    <t t-set="tot_debit" t-value="progressive_debit"/>
                    <t t-set="class_new_move" t-value="''"/>
                    <t t-set="date_from" t-value="data['date_move_line_from']"/>
                    <t t-set="date_to" t-value="data['date_move_line_to']"/>
                    <t t-foreach="get_move(data['ids'],number_row)" t-as="line_main">
                        <table style="width:100%; font-size: 8px !important;" cellspacing="0">
                        <style>
                            table {border: 0px;}
                            thead {background: #F5F5F5;}
                            .left_without_line {
                                font-family: "Monospace";
                                text-align:left; vertical-align:text-top;
                                padding:1px 3px;
                                height:22px; min-height:22px; max-height:22px;
                            }
                            .right_without_line {
                                font-family: "Monospace";
                                text-align:right; vertical-align:text-top;
                                padding:1px 3px;
                                height:22px; min-height:22px; max-height:22px;
                            }
                            .new_move {
                                border-top: 1px solid #A1A1A1;
                            }
                            .width_40 {
                                width:40px; min-width:40px; max-width:40px;
                            }
                            .width_55 {
                                width:55px; min-width:55px; max-width:55px;
                            }
                            .width_60 {
                                width:60px; min-width:60px; max-width:60px;
                            }
                            .width_70 {
                                width:70px; min-width:70px; max-width:70px;
                            }
                            .width_80 {
                                width:80px; min-width:80px; max-width:80px;
                            }
                            .width_175 {
                                width:175px; min-width:175px; max-width:175px;
                            }
                            .width_215 {
                                width:215px; min-width:215px; max-width:215px;
                                max-height:20px;
                            }
                        </style>
                        <thead>
                            <tr class="first_th_row">
                                <td colspan="9" style="padding:10px; font-weight: bold; font-size: 10px;"
                                    t-esc="'LIBRO GIORNALE - Periodo di stampa dal ' + time.strftime(date_format, time.strptime(str(date_from),'%Y-%m-%d')) + ' al ' + time.strftime(date_format, time.strptime(str(date_to),'%Y-%m-%d'))"/>
                            </tr>
                            <tr style="page-break-inside: avoid; border:1px solid #A1A1A1; ">
                                <th class="left_without_line width_40">Row</th>
                                <th class="left_without_line width_60">Date</th>
                                <th class="left_without_line width_80">Ref</th>
                                <th class="left_without_line width_80">Account move</th>
                                <th class="left_without_line width_55">Account code</th>
                                <th class="left_without_line width_175">Account name</th>
                                <th class="left_without_line width_215">Name</th>
                                <th class="right_without_line width_70">Debit</th>
                                <th class="right_without_line width_70">Credit</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="page-break-inside: avoid;">
                                <td class="left_without_line width_40"></td>
                                <td class="left_without_line width_60"></td>
                                <td class="left_without_line width_80"></td>
                                <td class="left_without_line width_80"></td>
                                <td class="left_without_line width_55"></td>
                                <td class="left_without_line width_175"></td>
                                <td class="left_without_line width_215">
                                        <span t-if="counter==start_row">Initial Balance</span>
                                        <span t-else="">Partial Balance</span>
                                    </td>
                                <!-- Debit -->
                                <td class="right_without_line width_70">
                                    <div style="page-break-inside: avoid"
                                         t-esc="formatLang(env, tot_debit)" />
                                </td>
                                <!-- Credit -->
                                <td class="right_without_line width_70">
                                    <div style="page-break-inside: avoid"
                                         t-esc="formatLang(env, tot_credit)" />
                                </td>
                                <t t-set="current_subtotal_debit" t-value="0.0"/>
                                <t t-set="current_subtotal_credit" t-value="0.0"/>
                            </tr>
                            <t t-foreach="line_main" t-as="line">

                                <t t-set="counter" t-value="counter + 1"/>
                                <t t-set="tot_credit" t-value="tot_credit + line.credit"/>
                                <t t-set="tot_debit" t-value="tot_debit + line.debit"/>
                                <t t-if="line.move_id.id != save_move_id">
                                    <t t-set="class_new_move" t-value="'new_move'"/>
                                </t>
                                <t t-if="line.move_id.id == save_move_id">
                                    <t t-set="class_new_move" t-value="''"/>
                                </t>

                                <tr style="page-break-inside: avoid;" t-att-class="class_new_move">
                                    <!-- Row -->
                                    <td class="left_without_line width_40">
                                        <div style="page-break-inside: avoid" t-esc="counter"/>
                                    </td>
                                    <!-- Date -->
                                    <td class="left_without_line width_60">
                                        <div style="page-break-inside: avoid"
                                         t-esc="time.strftime(date_format, time.strptime(str(line['date']),'%Y-%m-%d'))"/>
                                    </td>
                                    <!-- ref -->
                                    <td class="left_without_line width_80">
                                        <div style="page-break-inside: avoid;word-break: break-all;"
                                        t-esc="line.ref"/>
                                    </td>
                                    <!-- Account move -->
                                    <td class="left_without_line width_80">
                                        <div style="page-break-inside: avoid;word-break: break-all;"
                                        t-esc="line.move_id.name" />
                                    </td>
                                    <!-- Account code -->
                                    <td class="left_without_line width_55">
                                        <div style="page-break-inside: avoid"
                                        t-esc="line.account_id.code" />
                                    </td>
                                    <!-- Account name -->
                                    <td class="left_without_line width_175">
                                        <div style="page-break-inside: avoid;word-break: break-all;"
                                        t-esc="line.account_id.name" />
                                    </td>
                                    <!-- Name -->
                                    <td class="left_without_line width_215">
                                        <t t-if="line.account_id.user_type_id.type in ['receivable', 'payable']">
                                            <div style="page-break-inside: avoid;word-break: break-all;"
                                                 t-esc="line.partner_id.name" />
                                        </t>
                                        <t t-else="">
                                            <div style="page-break-inside: avoid;word-break: break-all;"
                                                 t-esc="line.name" />
                                        </t>
                                    </td>
                                    <!-- Debit -->
                                    <td class="right_without_line width_70">
                                        <div style="page-break-inside: avoid"
                                             t-esc="formatLang(env, line.debit)" />
                                    </td>
                                    <!-- Credit -->
                                    <td class="right_without_line width_70">
                                        <div style="page-break-inside: avoid"
                                             t-esc="formatLang(env, line.credit)" />
                                    </td>
                                </tr>
                                <t t-set="save_move_id" t-value="line.move_id.id"/>
                            </t>
                        </tbody>
                        <t t-set="class_new_move" t-value="'new_move'"/>
                        <tr style="page-break-inside: avoid;" t-att-class="class_new_move">
                            <td class="left_without_line width_40"></td>
                            <td class="left_without_line width_60"></td>
                            <td class="left_without_line width_80"></td>
                            <td class="left_without_line width_80"></td>
                            <td class="left_without_line width_55"></td>
                            <td class="left_without_line width_175"></td>
                            <td class="left_without_line width_215">
                                <span t-if="counter==len(data['ids'])">Final Balance</span>
                                <span t-else="">Balance Page</span>
                            </td>

                            <!-- Debit -->
                            <td class="right_without_line width_70">
                                <div style="page-break-inside: avoid"
                                     t-esc="formatLang(env, tot_debit)"/>
                            </td>
                            <!-- Credit -->
                            <td class="right_without_line width_70">
                                <div style="page-break-inside: avoid"
                                     t-esc="formatLang(env, tot_credit)"/>
                            </td>
                        </tr>
                    </table>
                        <span t-if="counter % number_row == 0">
                            <div style="page-break-after: always;"/>
                        </span>
                    </t>
                </div>
            </t>
            <t t-set="save_move_id" t-value="save_print_info(daterange,print_state,date_move_line_to,counter,tot_debit,tot_credit)"/>
        </t>
    </template>

</odoo>
